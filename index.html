<!DOCTYPE html>

<html>

<head>

  <title>Customer Pulse Alert Window</title>

  <style>

    body {

      font-family: Arial, sans-serif;

      margin: 0;

      padding: 0;

      background-color: #f9f9f9;

      color: #333;

    }

    header {

      background-color: #4CAF50;

      color: white;

      text-align: center;

      padding: 20px;

      font-size: 28px;

      font-weight: bold;

    }

    .container {

      max-width: 900px;

      margin: 30px auto;

      background: #fff;

      padding: 20px;

      border-radius: 8px;

      box-shadow: 0 4px 8px rgba(0,0,0,0.1);

    }

    h2 {

      margin-bottom: 15px;

      color: #4CAF50;

    }

    textarea {

      width: 100%;

      height: 150px;

      padding: 10px;

      font-size: 16px;

      border: 1px solid #ccc;

      border-radius: 4px;

      margin-bottom: 15px;

    }

    button {

      padding: 10px 20px;

      margin-right: 10px;

      font-size: 16px;

      border: none;

      border-radius: 4px;

      cursor: pointer;

      background-color: #4CAF50;

      color: white;

      transition: background-color 0.3s ease;

    }

    button:hover {

      background-color: #45a049;

    }

    #exportBtn {

      display: none;

      background-color: #2196F3;

    }

    #exportBtn:hover {

      background-color: #1976D2;

    }

    table {

      width: 100%;

      border-collapse: collapse;

      margin-top: 20px;

    }

    th, td {

      border: 1px solid #ddd;

      padding: 10px;

      text-align: center;

    }

    th {

      background-color: #4CAF50;

      color: white;

    }

    tr:nth-child(even) {

      background-color: #f2f2f2;

    }

    .not-found {

      color: red;

      font-style: italic;

    }

  </style>

</head>

<body>

  <header>Customer-pulse-alert-window</header>

  <div class="container">

    <h2>Enter up to 100 Registration Numbers (one per line)</h2>

    <textarea id="regnos" placeholder="WB12AB1234\nWB10XY5678\n..."></textarea><br>

    <button onclick="lookupBulk()">Search</button>

    <button id="exportBtn" onclick="exportCSV()">Export CSV</button>

    <div id="result"></div>

  </div>

 

  <script>

    let lastResults = [];

 

    function lookupBulk() {

      var regnos = document.getElementById('regnos').value.trim().split(/\n+/);

      regnos = regnos.map(r => r.trim()).filter(r => r.length > 0);

      if (regnos.length === 0) {

        document.getElementById('result').innerText = "Please enter at least one registration number.";

        return;

      }

      if (regnos.length > 100) {

        document.getElementById('result').innerText = "Limit is 100 registration numbers.";

        return;

      }

 

      fetch('https://script.google.com/macros/s/AKfycbzztseozm6EJ3OWn80XpfC3QpaTrS_RgrzMOe5slnzZijtwOgY3aBV5B0St9u1GB_jh/exec?regnos=' + encodeURIComponent(regnos.join(',')))

        .then(response => response.json())

        .then(data => {

          let foundMap = {};

          data.forEach(row => { foundMap[row.regno.toLowerCase()] = row; });

 

          let table = '<table><tr><th>Reg No</th><th>Escalated</th><th>Intello</th><th>WA Concern</th><th>Total</th></tr>';

          lastResults = [];

          regnos.forEach(r => {

            let key = r.toLowerCase();

            if (foundMap[key]) {

              table += `<tr>

                <td>${foundMap[key].regno}</td>

                <td>${foundMap[key].escalated || '-'}</td>

                <td>${foundMap[key].intello || '-'}</td>

                <td>${foundMap[key].waConcern || '-'}</td>

                <td>${foundMap[key].total || '-'}</td>

              </tr>`;

              lastResults.push({

                RegNo: foundMap[key].regno,

                Escalated: foundMap[key].escalated || '-',

                Intello: foundMap[key].intello || '-',

                WAConcern: foundMap[key].waConcern || '-',

                Total: foundMap[key].total || '-'

              });

            } else {

              table += `<tr>

                <td>${r}</td>

                <td colspan="4" class="not-found">Not Found</td>

              </tr>`;

              lastResults.push({

                RegNo: r,

                Escalated: 'Not Found',

                Intello: 'Not Found',

                WAConcern: 'Not Found',

                Total: 'Not Found'

              });

            }

          });

          table += '</table>';

          document.getElementById('result').innerHTML = table;

          document.getElementById('exportBtn').style.display = 'inline-block';

        })

        .catch(err => {

          document.getElementById('result').innerText = "Error fetching data.";

        });

    }

 

    function exportCSV() {

      if (lastResults.length === 0) return;

      let csvContent = 'Reg No,Escalated,Intello,WA Concern,Total\n';

      lastResults.forEach(row => {

        csvContent += `${row.RegNo},${row.Escalated},${row.Intello},${row.WAConcern},${row.Total}\n`;

      });

      let blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

      let url = URL.createObjectURL(blob);

      let link = document.createElement('a');

      link.setAttribute('href', url);

      link.setAttribute('download', 'vehicle_lookup_results.csv');

      document.body.appendChild(link);

      link.click();

      document.body.removeChild(link);

    }

  </script>

</body>

</html>
